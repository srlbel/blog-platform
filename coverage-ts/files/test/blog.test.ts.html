
  <!DOCTYPE html>
  <html>
    <head>
      <title>blog.test.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">test/blog.test.ts</td><td class="">100.00%</td><td class="">80%</td><td class="">225</td><td class="">225</td><td class="">0</td></tr></tbody></table><textarea id="editor" readOnly="" style="margin-top:3em">import { beforeEach, describe, expect, it } from &#x27;bun:test&#x27;;
import { treaty } from &#x27;@elysiajs/eden&#x27;;
import { blogRoutes } from &#x27;../src/routes/BlogRoutes&#x27;;
import { db } from &#x27;../src/db&#x27;;
import { blogs } from &#x27;../src/db/schema&#x27;;

const api = treaty(blogRoutes);

describe(&#x27;blog tests&#x27;, () =&gt; {
  const testBlog = {
    creator: &#x27;Creator&#x27;,
    slug: &#x27;https://a1.url.com&#x27;,
    title: &#x27;A title&#x27;,
    description: &#x27;A description&#x27;,
  };

  beforeEach(async () =&gt; {
    // purge test database for testing
    await db.delete(blogs);
  });

  describe(&#x27;GET /&#x27;, () =&gt; {
    it(&#x27;should returns an array of objects&#x27;, async () =&gt; {
      const { data, error } = await api.blogs.index.get();

      expect(error).toBeNull();
      expect(data).toBeArray();
      expect(data).toBeObject();
    });
  });

  describe(&#x27;POST /&#x27;, () =&gt; {
    it(&#x27;should create a single object&#x27;, async () =&gt; {
      const { data, error, status } = await api.blogs.index.post(testBlog);

      expect(error).toBeNull();

      expect(status).toBe(201);
      expect(data?.id).toBeDefined();
      expect(data?.title).toBe(testBlog.title);
    });

    it(&#x27;should validate the fields&#x27;, async () =&gt; {
      const { error } = await api.blogs.index.post({ title: &#x27;A title&#x27; });

      expect(error).not.toBeNull();
    });
  });

  describe(&#x27;GET /:id &#x27;, () =&gt; {
    it(&#x27;should return an object&#x27;, async () =&gt; {
      const { data: created } = await api.blogs.index.post(testBlog);

      const { data, error } = await api.blogs({ id: created.id }).get();

      expect(error).toBeNull();
      expect(data).toBeObject();
      expect(data?.id).toBe(created?.id);
      expect(data?.title).toBe(created?.title);
    });

    it(&#x27;should return 404 if blog not found&#x27;, async () =&gt; {
      const { data, error } = await api.blogs({ id: &#x27;no-id&#x27; }).get();

      expect(data).toBeNull();
      expect(error?.status).toBe(404);
    });
  });

  describe(&#x27;PUT /:id&#x27;, () =&gt; {
    it(&#x27;should update a blog&#x27;, async () =&gt; {
      const { data: created } = await api.blogs.index.post(testBlog);

      const updatedData = {
        title: &#x27;Updated Title&#x27;,
        description: &#x27;Updated Content&#x27;,
        creator: &#x27;Updated Author&#x27;,
        slug: &#x27;slug&#x27;,
      };

      const { error, status } = await api.blogs({ id: created.id }).put(updatedData);

      expect(error).toBeNull();
      expect(status).toBe(204);

      const { data: updated } = await api.blogs({ id: created.id }).get();
      expect(updated?.title).toBe(updatedData.title);
    });

    it(&#x27;should return 404 if blog to update not found&#x27;, async () =&gt; {
      const { error } = await api.blogs({ id: &#x27;non-existent-id&#x27; }).put(testBlog);

      expect(error?.status).toBe(404);
    });
  });

  describe(&#x27;DELETE /blogs/:id&#x27;, () =&gt; {
    it(&#x27;should delete a blog&#x27;, async () =&gt; {
      // First create a blog
      const { data: created } = await api.blogs.post(testBlog);

      // Using the correct treaty API format for path parameters
      const { error, status } = await api.blogs({ id: created.id }).delete();

      expect(error).toBeNull();
      expect(status).toBe(204);

      // Verify the blog is deleted
      const { data, error: getError } = await api.blogs({ id: created.id }).get();
      expect(data).toBeNull();
      expect(getError?.status).toBe(404);
    });

    it(&#x27;should return success even if blog to delete not found&#x27;, async () =&gt; {
      // This is a common API pattern - DELETE is idempotent
      const { status } = await api.blogs({ id: &#x27;non-existent-id&#x27; }).delete();

      expect(status).toBe(204);
    });
  });
});
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 11 May 2025 20:11:47 GMT</p>
    </body>
  </html>
  